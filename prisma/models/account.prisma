/// ========================================
/// ACCOUNT & EXCHANGE MODELS
/// ========================================

/// Exchange - 거래소 정보
/// 암호화폐 거래소의 기본 정보를 관리하는 모델
model Exchange {
  id Int @id @default(autoincrement())
  name String @unique /// 거래소명
  description String @default("") /// 설명
  created_at DateTime @default(now()) /// 생성 시각
  updated_at DateTime @updatedAt /// 수정 시각
  deactivated_at DateTime? /// 비활성화 시각

  // Relations
  accounts Account[]

  @@index([created_at])
  @@index([deactivated_at])
}

/// Account - 계좌 정보
/// 사용자의 거래 계좌 정보를 관리하는 모델
model Account {
  id Int @id @default(autoincrement())
  exchange_id Int /// Exchange 참조
  name String @default("") /// 계좌명
  description String @default("") /// 설명
  currency CurrencyType @default(USDT) /// 통화
  is_virtual Boolean @default(false) /// 가상 계좌 여부
  created_at DateTime @default(now()) /// 생성 시각
  updated_at DateTime @updatedAt /// 수정 시각
  deactivated_at DateTime? /// 비활성화 시각

  // Relations
  exchange Exchange @relation(fields: [exchange_id], references: [id])
  orders Order[]
  transactions Transaction[]
  account_risk_managements AccountRiskManagement[]

  @@index([exchange_id])
  @@index([created_at])
  @@index([deactivated_at])
}

/// Transaction - 거래 내역
/// 계좌의 모든 금전 변동 내역을 관리하는 모델
model Transaction {
  id Int @id @default(autoincrement())
  account_id Int /// Account 참조
  order_id Int @unique /// Order 참조
  type TransactionType /// 거래 유형
  amount String /// 변동 금액
  reserved_funds String /// 유보금
  available_balance String /// 가용 잔고
  description String @default("") /// 설명
  created_at DateTime @default(now()) /// 생성 시각
  updated_at DateTime @updatedAt /// 수정 시각
  deactivated_at DateTime? /// 비활성화 시각

  // Relations
  account Account @relation(fields: [account_id], references: [id])
  order Order? @relation(fields: [order_id], references: [id])

  @@index([account_id])
  @@index([order_id])
  @@index([type])
  @@index([created_at])
  @@index([deactivated_at])
} 